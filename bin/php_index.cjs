#!/usr/bin/env node
"use strict";var x=Object.create;var h=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var P=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var _=(e,i,s,p)=>{if(i&&typeof i=="object"||typeof i=="function")for(let r of j(i))!k.call(e,r)&&r!==s&&h(e,r,{get:()=>i[r],enumerable:!(p=v(i,r))||p.enumerable});return e};var u=(e,i,s)=>(s=e!=null?x(P(e)):{},_(i||!e||!e.__esModule?h(s,"default",{value:e,enumerable:!0}):s,e));var f=require("node:child_process"),a=u(require("node:console"),1),o=require("node:fs/promises"),b=require("node:os"),t=require("node:path"),y=u(require("node:process"),1),l=require("node:util");var m={bugs:"https://github.com/cedx/php-index/issues",description:"A PHP directory index generator.",homepage:"https://docs.belin.io/php-index",license:"MIT",name:"@cedx/php-index",repository:"cedx/php-index",type:"module",version:"2.1.2",author:{email:"cedric@belin.io",name:"C\xE9dric Belin",url:"https://belin.io"},bin:{php_index:"./bin/php_index.cjs"},devDependencies:{"@cedx/php-minifier":"^2.1.0","@fontsource-variable/material-symbols-rounded":"^5.0.26","@lit/localize":"^0.12.1","@lit/localize-tools":"^0.7.2","@lit/task":"^1.0.0","@popperjs/core":"^2.11.8","@types/bootstrap":"^5.2.10","@types/browser-sync":"^2.29.0","@types/eslint__js":"^8.42.3","@types/gulp":"^4.0.17","@types/node":"^20.11.30",bootstrap:"^5.3.3","browser-sync":"^3.0.2",del:"^7.1.0",esbuild:"^0.20.2",eslint:"^8.57.0",execa:"^8.0.1",gulp:"^4.0.2","gulp-replace":"^1.1.4",lit:"^3.1.2","minify-html-literals":"^1.3.5","sass-embedded":"^1.72.0","source-map-js":"^1.2.0",stylelint:"^16.2.1","stylelint-config-standard-scss":"^13.0.0",typescript:"^5.4.3","typescript-eslint":"^7.3.1"},engines:{node:">=20.0.0"},files:["bin/","lib/","src/console/","www/"],keywords:["cli","directory","generator","index","listing","php","web"],scripts:{prepack:"gulp",release:"gulp publish",start:"gulp cli && node bin/php_index.cjs --help"}};var A=`
Build the PHP Index redistributable.

Usage:
  php_index [options] <directory>

Arguments:
  directory       The path to the output directory.

Options:
  -c, --compress  Compress the Phar archive.
  -p, --phpinfo   Add a link to the PHP information.
  -h, --help      Display this help.
  -v, --version   Output the version number.
`;async function E(){let{positionals:e,values:i}=(0,l.parseArgs)({allowPositionals:!0,options:{compress:{short:"c",type:"boolean",default:!1},help:{short:"h",type:"boolean",default:!1},phpinfo:{short:"p",type:"boolean",default:!1},version:{short:"v",type:"boolean",default:!1}}});if(i.help||i.version)return a.default.log(i.version?m.version:A.trim());if(!e.length)throw Error("You must provide the path of the output directory.");let s=(0,t.join)(__dirname,".."),p=await(0,o.mkdtemp)((0,t.join)((0,b.tmpdir)(),"phpindex-"));for(let n of["lib","www"])await(0,o.cp)((0,t.join)(s,n),(0,t.join)(p,n),{recursive:!0});await(0,o.rm)((0,t.join)(p,"www/index.php"));let r=async(n,w,g)=>(0,o.writeFile)(n,(await(0,o.readFile)(n,{encoding:"utf8"})).replace(w,g)),c=i.phpinfo?"true":"false";await r((0,t.join)(p,"lib/config.json"),/"phpInfo":\s?[^,]+,/,`"phpInfo": ${c},`),await r((0,t.join)(p,"www/js/main.js"),/phpInfo:\s?[^,]+,/,`phpInfo: ${c},`);let d=(0,t.resolve)(e[0]);return await(0,o.mkdir)(d,{recursive:!0}),(0,l.promisify)(f.execFile)("php",[(0,t.join)(s,"bin/php_index.php"),"--input",p,"--output",d].concat(i.compress?["--compress"]:[]))}E().catch(e=>{a.default.error(e instanceof Error?e.message:e),y.default.exitCode=1});
