#!/usr/bin/env node
(function(oe){"use strict";var E=function(){return O.__string_rec(this,"")},$=$||{},g;class fe{constructor(e,t){this.r=new RegExp(e,t.split("u").join(""))}match(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,this.r.m!=null}matched(e){if(this.r.m!=null&&e>=0&&e<this.r.m.length)return this.r.m[e];throw y.thrown("EReg::matched")}}fe.__name__=!0;class p{static cca(e,t){let n=e.charCodeAt(t);if(n==n)return n}static substr(e,t,n){if(n==null)n=e.length;else if(n<0)if(t==0)n=e.length+n;else return"";return e.substr(t,n)}static now(){return Date.now()}}p.__name__=!0;class G{static iter(e,t){let n=_e(e);for(;n.hasNext();)t(n.next())}static fold(e,t,n){let l=_e(e);for(;l.hasNext();)n=t(l.next(),n);return n}static find(e,t){let n=_e(e);for(;n.hasNext();){let l=n.next();if(t(l))return l}return null}}G.__name__=!0,Math.__name__=!0;class j{static string(e){return O.__string_rec(e,"")}static random(e){return e<=0?0:Math.floor(Math.random()*e)}}j.__name__=!0;class D{static isSpace(e,t){let n=p.cca(e,t);return n>8&&n<14?!0:n==32}static ltrim(e){let t=e.length,n=0;for(;n<t&&D.isSpace(e,n);)++n;return n>0?p.substr(e,n,t-n):e}static rtrim(e){let t=e.length,n=0;for(;n<t&&D.isSpace(e,t-n-1);)++n;return n>0?p.substr(e,0,t-n):e}static trim(e){return D.ltrim(D.rtrim(e))}static lpad(e,t,n){if(t.length<=0)return e;let l="";for(n-=e.length;l.length<n;)l+=t==null?"null":""+t;return l+=e==null?"null":""+e,l}static replace(e,t,n){return e.split(t).join(n)}}D.__name__=!0;class ge{static systemName(){let e=process.platform;switch(e){case"darwin":return"Mac";case"freebsd":return"BSD";case"linux":return"Linux";case"win32":return"Windows";default:return e}}}ge.__name__=!0;var X=$["haxe.StackItem"]={__ename__:!0,__constructs__:null,CFunction:{_hx_name:"CFunction",_hx_index:0,__enum__:"haxe.StackItem",toString:E},Module:(g=function(a){return{_hx_index:1,m:a,__enum__:"haxe.StackItem",toString:E}},g._hx_name="Module",g.__params__=["m"],g),FilePos:(g=function(a,e,t,n){return{_hx_index:2,s:a,file:e,line:t,column:n,__enum__:"haxe.StackItem",toString:E}},g._hx_name="FilePos",g.__params__=["s","file","line","column"],g),Method:(g=function(a,e){return{_hx_index:3,classname:a,method:e,__enum__:"haxe.StackItem",toString:E}},g._hx_name="Method",g.__params__=["classname","method"],g),LocalFunction:(g=function(a){return{_hx_index:4,v:a,__enum__:"haxe.StackItem",toString:E}},g._hx_name="LocalFunction",g.__params__=["v"],g)};X.__constructs__=[X.CFunction,X.Module,X.FilePos,X.Method,X.LocalFunction];class y extends Error{constructor(e,t,n){super(e),this.message=e,this.__previousException=t,this.__nativeException=n??this}unwrap(){return this.__nativeException}get_native(){return this.__nativeException}static caught(e){return e instanceof y?e:e instanceof Error?new y(e.message,null,e):new ce(e,null,e)}static thrown(e){return e instanceof y?e.get_native():e instanceof Error?e:new ce(e)}}y.__name__=!0;class x{static ucompare(e,t){return e<0?t<0?~t-~e|0:1:t<0?-1:e-t|0}}class $e{static divMod(e,t){if(t.high==0)switch(t.low){case 0:throw y.thrown("divide by zero");case 1:return{quotient:new d(e.high,e.low),modulus:new d(0,0)}}let n=e.high<0!=t.high<0,l;if(e.high<0){let s=~e.high,u=~e.low+1|0;u==0&&(++s,s=s|0),l=new d(s,u)}else l=new d(e.high,e.low);if(t.high<0){let s=~t.high,u=~t.low+1|0;u==0&&(++s,s=s|0),t=new d(s,u)}let r=new d(0,0),i=new d(0,1);for(;!(t.high<0);){let s=x.ucompare(t.high,l.high),u=s!=0?s:x.ucompare(t.low,l.low);if(t=new d(t.high<<1|t.low>>>31,t.low<<1),i=new d(i.high<<1|i.low>>>31,i.low<<1),u>=0)break}for(;i.high!=0||i.low!=0;){let s=x.ucompare(l.high,t.high);if((s!=0?s:x.ucompare(l.low,t.low))>=0){r=new d(r.high|i.high,r.low|i.low);let u=l.high-t.high|0;x.ucompare(l.low,t.low)<0&&(--u,u=u|0),l=new d(u,l.low-t.low|0)}i=new d(i.high>>>1,i.high<<31|i.low>>>1),t=new d(t.high>>>1,t.high<<31|t.low>>>1)}if(n){let s=~r.high,u=~r.low+1|0;u==0&&(++s,s=s|0),r=new d(s,u)}if(e.high<0){let s=~l.high,u=~l.low+1|0;u==0&&(++s,s=s|0),l=new d(s,u)}return{quotient:r,modulus:l}}}class d{constructor(e,t){this.high=e,this.low=t}}d.__name__=!0;class me{static fromFloat(e){if(isNaN(e)||!isFinite(e))throw y.thrown("Number is NaN or Infinite");let t=e-e%1;if(t>9007199254740991)throw y.thrown("Conversion overflow");if(t<-9007199254740991)throw y.thrown("Conversion underflow");let n=new d(0,0),l=t<0,r=l?-t:t,i=0;for(;r>=1;){let s=r%2;if(r/=2,s>=1){let u=0,c=1,f=i;f&=63;let _=f==0?new d(u,c):f<32?new d(u<<f|c>>>32-f,c<<f):new d(c<<f-32,0),o=n.high+_.high|0,m=n.low+_.low|0;x.ucompare(m,n.low)<0&&(++o,o=o|0),n=new d(o,m)}++i}if(l){let s=~n.high,u=~n.low+1|0;u==0&&(++s,s=s|0),n=new d(s,u)}return n}}me.__name__=!0;class ce extends y{constructor(e,t,n){super(String(e),t,n),this.value=e}unwrap(){return this.value}}ce.__name__=!0;var Z=$["haxe.ds.Option"]={__ename__:!0,__constructs__:null,Some:(g=function(a){return{_hx_index:0,v:a,__enum__:"haxe.ds.Option",toString:E}},g._hx_name="Some",g.__params__=["v"],g),None:{_hx_name:"None",_hx_index:1,__enum__:"haxe.ds.Option",toString:E}};Z.__constructs__=[Z.Some,Z.None];class de{constructor(e){this.length=e.byteLength,this.b=new Uint8Array(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b}toHex(){let e="",t=[],n="0123456789abcdef",l=0,r=n.length;for(;l<r;)t.push(p.cca(n,l++));let i=0,s=this.length;for(;i<s;){let u=this.b[i++];e+=String.fromCodePoint(t[u>>4]),e+=String.fromCodePoint(t[u&15])}return e}}de.__name__=!0;class N{constructor(e){switch(e){case".":case"..":this.dir=e,this.file="";return}let t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");t<n?(this.dir=p.substr(e,0,n),e=p.substr(e,n+1,null),this.backslash=!0):n<t?(this.dir=p.substr(e,0,t),e=p.substr(e,t+1,null)):this.dir=null;let l=e.lastIndexOf(".");l!=-1?(this.ext=p.substr(e,l+1,null),this.file=p.substr(e,0,l)):(this.ext=null,this.file=e)}static directory(e){let t=new N(e);return t.dir==null?"":t.dir}static join(e){let t=[],n=0;for(;n<e.length;){let s=e[n];++n,s!=null&&s!=""&&t.push(s)}if(t.length==0)return"";let l=t[0],r=1,i=t.length;for(;r<i;)l=N.addTrailingSlash(l),l+=t[r++];return N.normalize(l)}static normalize(e){let t="/";if(e=e.split("\\").join(t),e==t)return t;let n=[],l=0,r=e.split(t);for(;l<r.length;){let _=r[l];++l,_==".."&&n.length>0&&n[n.length-1]!=".."?n.pop():_==""?(n.length>0||p.cca(e,0)==47)&&n.push(_):_!="."&&n.push(_)}let i="",s=!1,u=!1,c=0,f=n.join(t);for(;c<f.length;){let _=f,o=c++,m=_.charCodeAt(o);m>=55296&&m<=56319&&(m=m-55232<<10|_.charCodeAt(o+1)&1023);let h=m;h>=65536&&++c;let w=h;switch(w){case 47:if(!s)u=!0;else{let A=w;s=!1,u&&(i+="/",u=!1),i+=String.fromCodePoint(A)}break;case 58:i+=":",s=!0;break;default:let S=w;s=!1,u&&(i+="/",u=!1),i+=String.fromCodePoint(S)}}return i}static addTrailingSlash(e){if(e.length==0)return"/";let t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");return t<n?n!=e.length-1?e+"\\":e:t!=e.length-1?e+"/":e}static removeTrailingSlashes(e){e:for(;;){let t=p.cca(e,e.length-1);if(t==null)break;switch(t){case 47:case 92:e=p.substr(e,0,-1);break;default:break e}}return e}static isAbsolute(e){return!!(e.startsWith("/")||e.charAt(1)==":"||e.startsWith("\\\\"))}}N.__name__=!0;class we{constructor(e){this.current=0,this.array=e}hasNext(){return this.current<this.array.length}next(){return this.array[this.current++]}}we.__name__=!0;class O{static __string_rec(e,t){if(e==null)return"null";if(t.length>=5)return"<...>";let n=typeof e;switch(n=="function"&&(e.__name__||e.__ename__)&&(n="object"),n){case"function":return"<function>";case"object":if(e.__enum__){let c=$[e.__enum__].__constructs__[e._hx_index],f=c._hx_name;return c.__params__?(t=t+"	",f+"("+function(_){var o;let m=[];{let h=0,w=c.__params__;for(;h<w.length;){let S=w[h];h=h+1,m.push(O.__string_rec(e[S],t))}}return o=m,o}(this).join(",")+")"):f}if(e instanceof Array){let u="[";t+="	";let c=0,f=e.length;for(;c<f;){let _=c++;u+=(_>0?",":"")+O.__string_rec(e[_],t)}return u+="]",u}let l;try{l=e.toString}catch{return"???"}if(l!=null&&l!=Object.toString&&typeof l=="function"){let u=e.toString();if(u!="[object Object]")return u}let r=`{
`;t+="	";let i=e.hasOwnProperty!=null,s=null;for(s in e)i&&!e.hasOwnProperty(s)||s=="prototype"||s=="__class__"||s=="__super__"||s=="__interfaces__"||s=="__properties__"||(r.length!=2&&(r+=`, 
`),r+=t+s+" : "+O.__string_rec(e[s],t));return t=t.substring(1),r+=`
`+t+"}",r;case"string":return e;default:return String(e)}}}O.__name__=!0;var pe=require("child_process"),R=require("fs"),Te=require("path"),xe=require("buffer").Buffer;class Y{static get_packageVersion(){return Y.packageVersion==null&&(Y.packageVersion="0.3.1"),Y.packageVersion}}Y.__name__=!0;class T{constructor(){this.version=!1,this.help=!1,this.compress=!1}run(e){if(this.help||this.version){let h=this.version?Y.get_packageVersion():new ye().format(K.get());return process.stdout.write(j.string(h)),process.stdout.write(`
`),new H(new C(k.Success(null)))}let t=process.env.HAXELIB_RUN=="1";if(e.length<(t?2:1))return new H(new C(k.Failure(new P(400,"You must provide the path of the output directory.",{fileName:"src/php_index/cli/Program.hx",lineNumber:40,className:"php_index.cli.Program",methodName:"run"}))));let n=N.join([N.directory(__filename),".."]),l=N.join([T.tempDirectory(),v.v4()]);G.iter(["lib","www"],function(h){T.copyDirectory(N.join([n,h]),N.join([l,h]))});let r=["index.phar","index.php"],i=new Array(r.length),s=0,u=r.length;for(;s<u;){let h=s++;i[h]="www/"+r[h]}let c=q.exists,f=[],_=0;for(;_<i.length;){let h=i[_];++_,c(h)&&f.push(h)}G.iter(f,q.deleteFile);let o=N.isAbsolute(e[0])?e[0]:N.join([t?e[e.length-1]:process.cwd(),e[0]]);q.createDirectory(o);let m=[N.join([n,"bin/php_index.php"]),"--input",l,"--output",o].concat(this.compress?["--compress"]:[]);return m==null?pe.spawnSync("php",{shell:!0,stdio:"inherit"}):pe.spawnSync("php",m,{stdio:"inherit"}),new H(new C(k.Success(null)))}static main(){new Se(new T,new Ee(5)).process(process.argv.slice(2)).handle(be.exit)}static copyDirectory(e,t){let n=0,l=R.readdirSync(e);for(;n<l.length;){let r=l[n];++n;let i=N.join([e,r]),s=N.join([t,r]);q.isDirectory(i)?T.copyDirectory(i,s):(q.createDirectory(N.directory(s)),J.copy(i,s))}}static tempDirectory(){let e=function(t){let n=process.env[t];return n!=null?Z.Some(n):Z.None};if(ge.systemName()=="Windows"){let t=e("TMP"),n=new C(e("TEMP")),l=t._hx_index==0?t:M.get(n),r=e("SystemRoot"),i=new C(e("windir")),s=r._hx_index==0?r:M.get(i),u;if(s._hx_index==0)u=s.v;else throw y.thrown(new P(404,"Some value expected but none found",{fileName:"src/php_index/cli/Program.hx",lineNumber:75,className:"php_index.cli.Program",methodName:"tempDirectory"}));let c=l._hx_index==0?l.v:M.get(new C(u+"\\Temp"));return c.length>1&&!c.endsWith(":\\")?N.removeTrailingSlashes(c):c}else{let t=e("TMPDIR"),n=new C(e("TMP")),l=t._hx_index==0?t:M.get(n),r=new C(e("TEMP")),i=l._hx_index==0?l:M.get(r),s=i._hx_index==0?i.v:M.get(new C("/tmp"));return s.length>1?N.removeTrailingSlashes(s):s}}}T.__name__=!0;class q{static exists(e){try{return R.accessSync(e),!0}catch{return!1}}static isDirectory(e){try{return R.statSync(e).isDirectory()}catch{return!1}}static createDirectory(e){try{R.mkdirSync(e)}catch(t){let n=y.caught(t).unwrap();if(n.code=="ENOENT")q.createDirectory(Te.dirname(e)),R.mkdirSync(e);else{let l;try{l=R.statSync(e)}catch{throw n}if(!l.isDirectory())throw n}}}static deleteFile(e){R.unlinkSync(e)}}q.__name__=!0;class J{static copy(e,t){let n=R.openSync(e,"r"),l=R.openSync(t,"w",R.fstatSync(n).mode),r,i=0;for(;r=R.readSync(n,J.copyBuf,0,65536,i),r>0;)R.writeSync(l,J.copyBuf,0,r),i+=r;R.closeSync(n),R.closeSync(l)}}J.__name__=!0;class be{static exit(e){switch(e._hx_index){case 0:process.exit(0);break;case 1:let t=e.failure,n=t.message;t.data!=null&&(n+=", "+(t.data==null?"null":j.string(t.data))),process.stdout.write(j.string(n)),process.stdout.write(`
`);let l=t.code;process.exit(l);break}}}be.__name__=!0;class ke{constructor(e){this.buffer=e}}ke.__name__=!0;class K{static get(){return K.doc==null&&(K.doc={doc:" Build the PHP Index redistributable. ",commands:[{isDefault:!0,isSub:!1,names:[],doc:" <directory> : The path to the output directory. "}],flags:[{names:["--compress"],aliases:["c"],doc:" Compress the PHAR archive. "},{names:["--help"],aliases:["h"],doc:" Display this help. "},{names:["--version"],aliases:["v"],doc:" Output the version number. "}]}),K.doc}}K.__name__=!0;class le{constructor(e,t,n){this.command=e,this.prompt=t,this.hasFlags=n}processArgs(e){let t=this;return this.hasFlags?P.catchExceptions(function(){let n=le.expandAssignments(e),l=[],r=0,i=!1;for(;r<n.length;){let s=n[r];if(s=="--")i=!0,++r;else if(!i&&p.cca(s,0)==45){let u=t.processFlag(n,r);if(u==-1)if(p.cca(s,1)!=45){let c=t.processAlias(n,r);if(c==-1)throw y.thrown('Unrecognized alias "'+s+'"');r+=c+1}else throw y.thrown('Unrecognized flag "'+s+'"');else r+=u+1}else l.push(s),++r}return l},null,{fileName:"tink/cli/Router.hx",lineNumber:25,className:"tink.cli.Router",methodName:"processArgs"}):k.Success(e)}processFlag(e,t){return-1}processAlias(e,t){return-1}static expandAssignments(e){let t=[],n=!0,l=0;for(;l<e.length;){let r=e[l];if(++l,r=="--"&&(n=!1),!n)t.push(r);else{let i=p.cca(r,0),s=p.cca(r,1),u=r.indexOf("=");i==null?t.push(r):i==45?s==null?t.push(r):s==45&&u!=-1?(t.push(p.substr(r,0,u)),t.push(p.substr(r,u+1,null))):t.push(r):t.push(r)}}return t}}le.__name__=!0;class Se extends le{constructor(e,t){super(e,t,!0)}process(e){let t=this;if(e[0]==null){let n,l=this.processArgs(e);switch(l._hx_index){case 0:n=l.data;break;case 1:return new H(new C(k.Failure(l.failure)))}return je.next(this.promptRequired(),function(r){return t.run_run(n)})}else{let n,l=this.processArgs(e);switch(l._hx_index){case 0:n=l.data;break;case 1:return new H(new C(k.Failure(l.failure)))}return je.next(this.promptRequired(),function(r){return t.run_run(n)})}}processFlag(e,t){switch(e[t]){case"--compress":this.command.compress=!0;break;case"--help":this.command.help=!0;break;case"--version":this.command.version=!0;break;default:return-1}return t-t}processAlias(e,t){let n=e[t],l=1,r=n.length;for(;l<r;){let i=l++,s=p.cca(n,i);if(s==null)throw y.thrown("Invalid alias '-"+n.charAt(i)+"'");switch(s){case 99:this.command.compress=!0;break;case 104:this.command.help=!0;break;case 118:this.command.version=!0;break;default:throw y.thrown("Invalid alias '-"+n.charAt(i)+"'")}}return t-t}promptRequired(){return I.async(function(e){e(k.Success(null))})}run_run(e){return e.length<0?new H(new C(k.Failure(new P(null,"Insufficient arguments. Expected: 0, Got: "+e.length,{fileName:"src/php_index/cli/Program.hx",lineNumber:31,className:"tink.cli.Router0",methodName:"run_run"})))):this.command.run(e.slice(0,e.length))}}Se.__name__=!0;class ye{constructor(e){this.re=new fe("^\\s*\\*?\\s{0,2}(.*)$",""),this.root=e}format(e){let t="";t+=`
`;let n=this.formatDoc(e.doc);n!=null&&(t+=j.string(""+n+`

`));let l=e.commands,r=[],i=0;for(;i<l.length;){let c=l[i];++i,c.isDefault||r.push(c)}this.root!=null&&(t+=j.string("  Usage: "+this.root+`
`));let s=G.find(e.commands,function(c){return c.isDefault});if(s!=null){let c=this.formatDoc(s.doc);c!=null&&(t+=j.string(this.indent(c,4)+`

`))}let u=this;if(r.length>0){let c=G.fold(r,function(o,m){let h=0,w=o.names;for(;h<w.length;){let S=w[h];++h,S.length>m&&(m=S.length)}return m},0);this.root!=null&&(t+=j.string("  Usage: "+this.root+` <subcommand>
`)),t+=j.string(`    Subcommands:
`);let f=function(o,m){m==null&&(m="(doc missing)"),t+=j.string(u.indent(D.lpad(o," ",c)+" : "+D.trim(u.indent(m,c+3)),6)+`
`)},_=0;for(;_<r.length;){let o=r[_];++_;let m=o.names[0];if(f(m,this.formatDoc(o.doc)),o.names.length>1){let h=1,w=o.names.length;for(;h<w;)f(o.names[h++],"Alias of "+m)}}}if(e.flags.length>0){let c=function(h){let w=h.names.join(", ");if(h.aliases.length>0){let S=h.aliases,A=new Array(S.length),V=0,te=S.length;for(;V<te;){let B=V++;A[B]="-"+S[B]}w+=", "+A.join(", ")}return w},f=G.fold(e.flags,function(h,w){let S=c(h);return S.length>w&&(w=S.length),w},0),_=function(h,w){w==null&&(w=""),t+=j.string(u.indent(D.lpad(h," ",f)+" : "+D.trim(u.indent(w,f+3)),6)+`
`)};t=(t+=`
`)+j.string(`  Flags:
`);let o=0,m=e.flags;for(;o<m.length;){let h=m[o];++o,_(c(h),this.formatDoc(h.doc))}}return t}indent(e,t){let n=e.split(`
`),l=new Array(n.length),r=0,i=n.length;for(;r<i;){let s=r++;l[s]=D.lpad(""," ",t)+n[s]}return l.join(`
`)}formatDoc(e){if(e==null)return null;let t=e.split(`
`),n=D.trim,l=new Array(t.length),r=0,i=t.length;for(;r<i;){let _=r++;l[_]=n(t[_])}let s=l;for(;s[0]=="";)s=s.slice(1);for(;s[s.length-1]=="";)s.pop();let u=new Array(s.length),c=0,f=s.length;for(;c<f;){let _=c++,o=s[_];u[_]=this.re.match(o)?this.re.matched(1):o}return u.join(`
`)}}ye.__name__=!0;class ve{constructor(e,t){this.source=e,this.sink=t}}ve.__name__=!0;class Ne extends ve{constructor(){let e=process.stdin,t=null;t={},super(ee.wrap("stdin",e,t.chunkSize,t.onEnd),re.wrap("stdout",process.stdout))}}Ne.__name__=!0;class Ee{constructor(e,t){this.trials=e,this.proxy=t??new Ne}}Ee.__name__=!0;class b{static invoke(e,t){b.depth<500?(b.depth++,e(t),b.depth--):b.defer(function(){e(t)})}static defer(e){process.nextTick(e)}}class Fe{constructor(){}cancel(){let e=this.link;e?.cancel()}}Fe.__name__=!0;class he{constructor(e,t){this.dissolved=!1,this.a=e,this.b=t}cancel(){if(!this.dissolved){this.dissolved=!0;let e=this.a;e?.cancel();let t=this.b;t?.cancel(),this.a=null,this.b=null}}}he.__name__=!0;class Ae{constructor(e,t){if(e==null)throw y.thrown("callback expected but null received");this.cb=e,this.list=t}cancel(){if(this.list!=null){let e=this.list;this.cb=null,this.list=null,--e.used<=e.cells.length>>1&&e.compact()}}}Ae.__name__=!0;class W{constructor(e){W._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.disposeHandlers=[],this.f=e}dispose(){let e=this.disposeHandlers;if(e!=null){this.disposeHandlers=null;let t=this.f;this.f=W.noop,t();let n=0;for(;n<e.length;)e[n++]()}}static noop(){}}W.__name__=!0;class Ce extends W{constructor(e){W._hx_skip_constructor=!0,super(),W._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){e==null&&(e=!1),this.onfill=function(){},this.ondrain=function(){},this.busy=!1,this.queue=[],this.used=0;let t=this;super._hx_constructor(function(){t.busy||t.destroy()}),this.destructive=e,this.cells=[]}destroy(){let e=0,t=this.cells;for(;e<t.length;){let n=t[e];++e,n.cb=null,n.list=null}if(this.queue=null,this.cells=null,this.used>0){this.used=0;let n=this.ondrain;b.depth<500?(b.depth++,n(),b.depth--):b.defer(n)}}invoke(e){let t=this;if(b.depth<500){if(b.depth++,t.disposeHandlers!=null)if(t.busy){if(t.destructive!=!0){let n=Oe(t,t.invoke),l=e,r=function(){n(l)};t.queue.push(r)}}else{t.busy=!0,t.destructive&&t.dispose();let n=t.cells.length,l=0;for(;l<n;){let r=t.cells[l++];r.list!=null&&r.cb(e)}t.busy=!1,t.disposeHandlers==null?t.destroy():(t.used<t.cells.length&&t.compact(),t.queue.length>0&&t.queue.shift()())}b.depth--}else b.defer(function(){if(t.disposeHandlers!=null)if(t.busy){if(t.destructive!=!0){let n=Oe(t,t.invoke),l=e,r=function(){n(l)};t.queue.push(r)}}else{t.busy=!0,t.destructive&&t.dispose();let n=t.cells.length,l=0;for(;l<n;){let r=t.cells[l++];r.list!=null&&r.cb(e)}t.busy=!1,t.disposeHandlers==null?t.destroy():(t.used<t.cells.length&&t.compact(),t.queue.length>0&&t.queue.shift()())}})}compact(){if(!this.busy)if(this.used==0){this.resize(0);let e=this.ondrain;b.depth<500?(b.depth++,e(),b.depth--):b.defer(e)}else{let e=0,t=0,n=this.cells.length;for(;t<n;){let l=t++,r=this.cells[l];if(r.cb!=null&&(e!=l&&(this.cells[e]=r),++e==this.used))break}this.resize(this.used)}}resize(e){this.cells.length=e}}Ce.__name__=!0;class P{constructor(e,t,n){e==null&&(e=500),this.isTinkError=!0,this.code=e,this.message=t,this.pos=n,this.exceptionStack=[],this.callStack=[]}printPos(){return this.pos.className+"."+this.pos.methodName+":"+this.pos.lineNumber}toString(){let e="Error#"+this.code+": "+this.message;return this.pos!=null&&(e+=" @ "+this.printPos()),e}static withData(e,t,n,l){return P.typed(e,t,n,l)}static typed(e,t,n,l){let r=new P(e,t,l);return r.data=n,r}static asError(e){return e!=null&&e.isTinkError?e:null}static catchExceptions(e,t,n){try{return k.Success(e())}catch(l){let r=P.asError(y.caught(l).unwrap());return k.Failure(r??(t==null?P.withData(null,"Unexpected Error",r,n):t(r)))}}}P.__name__=!0;class Re{constructor(){}getStatus(){return F.NeverEver}handle(e){return null}eager(){}}Re.__name__=!0;class C{constructor(e){this.value=e}isComputed(){return!0}get(){return this.value}compute(){}}C.__name__=!0;class H{constructor(e){this.value=e}getStatus(){return F.Ready(this.value)}handle(e){return b.invoke(e,M.get(this.value)),null}eager(){this.value.isComputed()||M.get(this.value)}}H.__name__=!0;class I{static first(e,t){let n=e;switch(n.getStatus()._hx_index){case 3:switch(t.getStatus()._hx_index){case 3:return n;case 4:return n;default:return n}break;case 4:return t;default:switch(t.getStatus()._hx_index){case 3:return t;case 4:return n;default:return new U(function(l){return new he(e.handle(l),t.handle(l))})}}}static flatMap(e,t,n){let l=e.getStatus();switch(l._hx_index){case 3:let r=l.result;return new U(function(i){return t(M.get(r)).handle(function(s){i(s)})});case 4:return I.NEVER;default:return new U(function(i){let s=new Fe;return new he(e.handle(function(u){let c=t(u).handle(i);s.link=c}),s)})}}static async(e,t){t==null&&(t=!1);let n=I.irreversible(e);return t||n.eager(),n}static irreversible(e){return new U(function(t){return e(t),null})}}var F=$["tink.core.FutureStatus"]={__ename__:!0,__constructs__:null,Suspended:{_hx_name:"Suspended",_hx_index:0,__enum__:"tink.core.FutureStatus",toString:E},Awaited:{_hx_name:"Awaited",_hx_index:1,__enum__:"tink.core.FutureStatus",toString:E},EagerlyAwaited:{_hx_name:"EagerlyAwaited",_hx_index:2,__enum__:"tink.core.FutureStatus",toString:E},Ready:(g=function(a){return{_hx_index:3,result:a,__enum__:"tink.core.FutureStatus",toString:E}},g._hx_name="Ready",g.__params__=["result"],g),NeverEver:{_hx_name:"NeverEver",_hx_index:4,__enum__:"tink.core.FutureStatus",toString:E}};F.__constructs__=[F.Suspended,F.Awaited,F.EagerlyAwaited,F.Ready,F.NeverEver];class U{constructor(e){this.status=F.Suspended,this.wakeup=e,this.callbacks=new Ce(!0);let t=this;this.callbacks.ondrain=function(){if(t.status==F.Awaited){t.status=F.Suspended;let n=t.link;n?.cancel(),t.link=null}},this.callbacks.onfill=function(){t.status==F.Suspended&&(t.status=F.Awaited,t.arm())}}getStatus(){return this.status}trigger(e){if(this.status._hx_index!=3){this.status=F.Ready(new C(e));let t=this.link;this.link=null,this.wakeup=null,this.callbacks.invoke(e),t?.cancel()}}handle(e){let t=this.status;if(t._hx_index==3)return b.invoke(e,M.get(t.result)),null;{let n=this.callbacks;if(n.disposeHandlers==null)return null;{let l=new Ae(e,n);if(n.cells.push(l),n.used++==0){let r=n.onfill;b.depth<500?(b.depth++,r(),b.depth--):b.defer(r)}return l}}}arm(){let e=this;this.link=this.wakeup(function(t){e.trigger(t)})}eager(){switch(this.status._hx_index){case 0:this.status=F.EagerlyAwaited,this.arm();break;case 1:this.status=F.EagerlyAwaited;break;default:}}}U.__name__=!0;class M{static get(e){return e.compute(),e.get()}}var k=$["tink.core.Outcome"]={__ename__:!0,__constructs__:null,Success:(g=function(a){return{_hx_index:0,data:a,__enum__:"tink.core.Outcome",toString:E}},g._hx_name="Success",g.__params__=["data"],g),Failure:(g=function(a){return{_hx_index:1,failure:a,__enum__:"tink.core.Outcome",toString:E}},g._hx_name="Failure",g.__params__=["failure"],g)};k.__constructs__=[k.Success,k.Failure];class je{static next(e,t,n){return I.flatMap(e,function(l){switch(l._hx_index){case 0:return t(l.data);case 1:return new H(new C(k.Failure(l.failure)))}})}}class De{}De.__name__=!0;class Pe{constructor(){}}Pe.__name__=!0;class Ie extends Pe{constructor(e){super(),this.upcoming=e}}Ie.__name__=!0;class re extends De{constructor(e){super(),this.target=e}static wrap(e,t){return new re(new Le(e,t))}}re.__name__=!0;class ee extends Ie{constructor(e){super(I.async(function(t){e.read().handle(function(n){let l=t,r;switch(n._hx_index){case 0:let i=n.data;r=i==null?z.End:z.Link(i,new ee(e));break;case 1:r=z.Fail(n.failure);break}l(r)})},!0))}static wrap(e,t,n,l){return new ee(new Me(e,t,n,l))}}ee.__name__=!0;class Me{constructor(e,t,n,l){this.name=e,this.native=t,this.chunkSize=n;let r=I.async(function(i){t.once("end",function(){i(k.Success(null))}),t.once("error",function(s){i(k.Failure(new P(null,""+s.code+" - Failed reading from "+e+" because "+s.message,{fileName:"tink/io/nodejs/WrappedReadable.hx",lineNumber:22,className:"tink.io.nodejs.WrappedReadable",methodName:"new"})))})});r.eager(),this.end=r,l!=null&&this.end.handle(function(){process.nextTick(l)})}read(){let e=this;return I.first(I.async(function(t){let n=null;n=function(){try{let l=e.native.read(e.chunkSize);if(l==null)e.native.once("readable",n);else{let r=typeof l=="string"?new xe(l):l;t(k.Success(new ke(r)))}}catch(l){let r=y.caught(l).unwrap();t(k.Failure(P.withData(null,"Error while reading from "+e.name,r,{fileName:"tink/io/nodejs/WrappedReadable.hx",lineNumber:48,className:"tink.io.nodejs.WrappedReadable",methodName:"read"})))}},n()}),this.end)}}Me.__name__=!0;class Le{constructor(e,t){this.name=e,this.native=t,this.ended=I.async(function(n){t.once("end",function(){n(k.Success(!1))}),t.once("finish",function(){n(k.Success(!1))}),t.once("close",function(){n(k.Success(!1))}),t.on("error",function(l){n(k.Failure(new P(null,""+l.code+": "+l.message,{fileName:"tink/io/nodejs/WrappedWritable.hx",lineNumber:24,className:"tink.io.nodejs.WrappedWritable",methodName:"new"})))})})}}Le.__name__=!0;var z=$["tink.streams.Step"]={__ename__:!0,__constructs__:null,Link:(g=function(a,e){return{_hx_index:0,value:a,next:e,__enum__:"tink.streams.Step",toString:E}},g._hx_name="Link",g.__params__=["value","next"],g),Fail:(g=function(a){return{_hx_index:1,e:a,__enum__:"tink.streams.Step",toString:E}},g._hx_name="Fail",g.__params__=["e"],g),End:{_hx_name:"End",_hx_index:2,__enum__:"tink.streams.Step",toString:E}};z.__constructs__=[z.Link,z.Fail,z.End];class v{static splitmix64_seed(e){let t=e.high+-1640531527|0,n=e.low+2135587861|0;x.ucompare(n,e.low)<0&&(++t,t=t|0);let l=new d(t,n),r=new d(l.high>>30,l.high<<2|l.low>>>30),i=l.high^r.high,s=l.low^r.low,u=484763065,c=s&65535,f=s>>>16,_=u&65535,o=u>>>16,m=x._mul(c,_),h=x._mul(f,_),w=x._mul(c,o),S=m,A=(x._mul(f,o)+(w>>>16)|0)+(h>>>16)|0;w<<=16,S=m+w|0,x.ucompare(S,w)<0&&(++A,A=A|0),h<<=16,S=S+h|0,x.ucompare(S,h)<0&&(++A,A=A|0),A=A+(x._mul(s,-1084733587)+x._mul(i,u)|0)|0,l=new d(A,S);let V=new d(l.high>>27,l.high<<5|l.low>>>27),te=l.high^V.high,B=l.low^V.low,ne=321982955,se=B&65535,ie=B>>>16,qe=ne&65535,We=ne>>>16,He=x._mul(se,qe),ue=x._mul(ie,qe),ae=x._mul(se,We),Q=He,L=(x._mul(ie,We)+(ae>>>16)|0)+(ue>>>16)|0;ae<<=16,Q=He+ae|0,x.ucompare(Q,ae)<0&&(++L,L=L|0),ue<<=16,Q=Q+ue|0,x.ucompare(Q,ue)<0&&(++L,L=L|0),L=L+(x._mul(B,-1798288965)+x._mul(te,ne)|0)|0,l=new d(L,Q);let Be=new d(l.high>>31,l.high<<1|l.low>>>31);return new d(l.high^Be.high,l.low^Be.low)}static randomFromRange(e,t){let n=v.state0,l=v.state1;v.state0=l;let r=new d(n.high<<23|n.low>>>9,n.low<<23);n=new d(n.high^r.high,n.low^r.low);let i=new d(n.high>>>18,n.high<<14|n.low>>>18),s=new d(l.high>>>5,l.high<<27|l.low>>>5);v.state1=new d(n.high^l.high^i.high^s.high,n.low^l.low^i.low^s.low);let u=v.state1,c=u.high+l.high|0,f=u.low+l.low|0;x.ucompare(f,u.low)<0&&(++c,c=c|0);let _=t-e+1,o=$e.divMod(new d(c,f),new d(_>>31,_)).modulus.low;return o<0&&(o=-o),o+e}static randomByte(){return v.randomFromRange(0,255)}static toShort(e,t,n){return n==null&&(n="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t==null&&(t="-"),e=D.replace(e,t,"").toLowerCase(),v.convert(e,"0123456789abcdef",n)}static v4(e,t,n,l,r){r==null&&(r="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),l==null&&(l=!1),n==null&&(n="-"),t==null&&(t=v.randomByte);let i=e;if(e==null){i=new de(new ArrayBuffer(16));let u=t();i.b[0]=u;let c=t();i.b[1]=c;let f=t();i.b[2]=f;let _=t();i.b[3]=_;let o=t();i.b[4]=o;let m=t();i.b[5]=m;let h=t();i.b[6]=h;let w=t();i.b[7]=w;let S=t();i.b[8]=S;let A=t();i.b[9]=A;let V=t();i.b[10]=V;let te=t();i.b[11]=te;let B=t();i.b[12]=B;let ne=t();i.b[13]=ne;let se=t();i.b[14]=se;let ie=t();i.b[15]=ie}else if(e.length<16)throw y.thrown("Random bytes should be at least 16 bytes");i.b[6]=i.b[6]&15|64,i.b[8]=i.b[8]&63|128;let s=v.stringify(i,n);return l&&(s=v.toShort(s,n,r)),s}static stringify(e,t){return t==null&&(t="-"),v.hexToUuid(e.toHex(),t)}static hexToUuid(e,t){return p.substr(e,0,8)+t+p.substr(e,8,4)+t+p.substr(e,12,4)+t+p.substr(e,16,4)+t+p.substr(e,20,12)}static convert(e,t,n){let l=t.length,r=n.length,i=e.length,s="",u=new Array(i),c=0,f=0,_=0,o=i;for(;_<o;){let m=_++;u[m]=t.indexOf(e.charAt(m))}for(;;){c=0,f=0;let m=0,h=i;for(;m<h;)c=c*l+u[m++],c>=r?(u[f++]=Math.floor(c/r),c%=r):f>0&&(u[f++]=0);if(i=f,s=n.charAt(c)+s,f==0)break}return s}}v.__name__=!0;function _e(a){return a instanceof Array?new we(a):a.iterator()}function Oe(a,e){if(e==null)return null;e.__id__==null&&(e.__id__=oe.$haxeUID++);var t;return a.hx__closures__==null?a.hx__closures__={}:t=a.hx__closures__[e.__id__],t==null&&(t=e.bind(a),a.hx__closures__[e.__id__]=t),t}oe.$haxeUID|=0,typeof performance<"u"&&typeof performance.now=="function"&&(p.now=performance.now.bind(performance)),String.fromCodePoint==null&&(String.fromCodePoint=function(a){return a<65536?String.fromCharCode(a):String.fromCharCode((a>>10)+55232)+String.fromCharCode((a&1023)+56320)}),String.__name__=!0,Array.__name__=!0,O.__toStr={}.toString,x._mul=Math.imul??function(a,e){return a*(e&65535)+(a*(e>>>16)<<16|0)|0},J.copyBuf=xe.alloc(65536),b.depth=0,W._hx_skip_constructor=!1,I.NEVER=new Re,v.rndSeed=me.fromFloat(Date.now()),v.state0=v.splitmix64_seed(v.rndSeed),v.state1=function(a){var e;let t=v.rndSeed,n=j.random(1e4),l=t.high+(n>>31)|0,r=t.low+n|0;x.ucompare(r,t.low)<0&&(++l,l=l|0);let i=l+0|0,s=r+1|0;return x.ucompare(s,r)<0&&(++i,i=i|0),e=v.splitmix64_seed(new d(i,s)),e}(this),T.main()})(global);
